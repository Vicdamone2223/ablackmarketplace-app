<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="vite.svg" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover, interactive-widget=resizes-content"
    />
    <title>Black Book</title>

    <!-- System UI tint -->
    <meta name="theme-color" content="#111827" />

    <!-- Safe-area CSS variables (with 24px fallback if env() returns 0) -->
    <style>
      :root {
        --safe-top: 24px;      /* fallback */
        --safe-bottom: 24px;   /* fallback */
      }
    </style>
    <script>
      (function () {
        try {
          const probe = document.createElement('div');
          probe.style.cssText =
            'position:fixed;top:0;left:0;visibility:hidden;' +
            'padding-top:env(safe-area-inset-top);' +
            'padding-bottom:env(safe-area-inset-bottom);';
          document.documentElement.appendChild(probe);
          const cs = getComputedStyle(probe);
          const top = parseFloat(cs.paddingTop) || 0;
          const bottom = parseFloat(cs.paddingBottom) || 0;
          if (top > 0) document.documentElement.style.setProperty('--safe-top', top + 'px');
          if (bottom > 0) document.documentElement.style.setProperty('--safe-bottom', bottom + 'px');
          probe.remove();
        } catch (_) {}
      })();
    </script>

    <!-- Ensure dark mode class is present before the app renders -->
    <script>
      (function () {
        try {
          const saved = localStorage.getItem('theme');
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          const shouldDark = saved === 'dark' || (!saved && prefersDark);
          document.documentElement.classList.toggle('dark', shouldDark);
        } catch (_) {}
      })();
    </script>
  </head>

  <body class="bg-white text-black dark:bg-gray-900 dark:text-white transition-colors duration-300">
    <div id="root"></div>

    <!-- BEGIN: panic overlay to catch runtime errors on device -->
    <style>
      #panic {
        position: fixed; inset: 0; background: #111; color: #f55;
        font: 13px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        padding: 16px; z-index: 999999; display: none; overflow:auto;
      }
      #panic b { color: #fff; }
    </style>
    <div id="panic"></div>
    <script>
      (function () {
        const box = document.getElementById('panic');
        function show(msg, stack) {
          box.style.display = 'block';
          box.innerHTML =
            '<b>ðŸ’¥ Runtime error</b><br><br>' +
            (msg ? (String(msg).replace(/</g, '&lt;') + '<br><br>') : '') +
            (stack
              ? '<pre style="white-space:pre-wrap;">' +
                String(stack).replace(/</g, '&lt;') +
                '</pre>'
              : '');
        }
        window.addEventListener('error', function (e) {
          show(e.message || e.error, e.error && e.error.stack);
        });
        window.addEventListener('unhandledrejection', function (e) {
          const r = e.reason || {};
          show(r.message || String(r), r.stack);
        });
        // sanity marker so we know correct bundle loaded
        fetch('version.txt')
          .then((r) => r.text())
          .then((t) => {
            console.log('[ABM] bundle version', t);
          })
          .catch(() => {});
      })();
    </script>
    <!-- END: panic overlay -->

    <!-- IMPORTANT: absolute-from-root path for dev -->
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
